Cannot invoke "com.epay.transaction.util.enums.PayMode.name()" because the return value of "com.epay.transaction.dto.RefundBookingDto.getPayMode()" is null
java.lang.NullPointerException: Cannot invoke "com.epay.transaction.util.enums.PayMode.name()" because the return value of "com.epay.transaction.dto.RefundBookingDto.getPayMode()" is null


    @Test
    void downloadRefundBookings_Success() throws IOException {
        byteArrayOutputStream = new ByteArrayOutputStream();
        ServletOutputStream servletOutputStream = new DelegatingServletOutputStream(byteArrayOutputStream);
        when(response.getOutputStream()).thenReturn(servletOutputStream);
        // Arrange
        List<RefundBookingDto> refundBookings = List.of(testRefundBookingDto);
        when(refundDao.downloadRefundBookingRequest(testRefundSearchRequest)).thenReturn(refundBookings);

        // Act
        refundService.downloadRefundBookings(response, testRefundSearchRequest);

        // Assert
        verify(refundDao, times(1)).downloadRefundBookingRequest(testRefundSearchRequest);
    }

public class RefundSearchRequest {

    @NotBlank(message = "mId is required")
    @JsonProperty("mId")
    private String mId;
    private String atrnNumber;
    private String arrnNumber;
    private String sbiOrderRefNumber;
    private String refundStatus;
    private String refundType;
    private String payMode;
    private Long from;
    private Long to;

}

public class RefundBookingDto {
    @JsonProperty("mId")
    private String mId;
    private String sbiOrderRefNumber;
    private String arrnNumber;
    private String atrnNumber;
    private BigDecimal refundAmount;
    private String refundType;
    private String refundStatus;
    private PayMode payMode;
    private String remark;
    private String createdBy;
    private Long createdDate;
    private String updatedBy;
    private Long updatedDate;
    private Integer refundRetry;
    private Long refundAdjustedDate;
    private String settlementStatus;
    private Long refundProcessedDate;
}



@Test
void downloadRefundBookings_Success() throws IOException {
    byteArrayOutputStream = new ByteArrayOutputStream();
    ServletOutputStream servletOutputStream = new DelegatingServletOutputStream(byteArrayOutputStream);
    when(response.getOutputStream()).thenReturn(servletOutputStream);

    // Arrange
    testRefundBookingDto.setPayMode(PayMode.UPI);  // <-- IMPORTANT FIX

    List<RefundBookingDto> refundBookings = List.of(testRefundBookingDto);
    when(refundDao.downloadRefundBookingRequest(testRefundSearchRequest))
            .thenReturn(refundBookings);

    // Act
    refundService.downloadRefundBookings(response, testRefundSearchRequest);

    // Assert
    verify(refundDao, times(1)).downloadRefundBookingRequest(testRefundSearchRequest);
}
